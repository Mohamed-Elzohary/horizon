_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[29],{IA1E:function(e,t,r){"use strict";r.d(t,"a",(function(){return d}));var n=r("vJKn"),a=r.n(n),s=r("rg98"),i=r("q1tI"),c=r("/MKj"),o=r("j6IE"),l=r("20a2"),u=r("jeBt");function d(){var e=Object(l.useRouter)(),t=Object(c.b)(),r=Object(c.c)((function(e){return e.user})),n=Object(i.useState)(!r),d=n[0],b=n[1],j=Object(i.useState)(r),O=j[0],f=j[1];function v(){return(v=Object(s.a)(a.a.mark((function r(){var n,s,i;return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return b(!0),r.next=3,Object(u.b)("".concat(e.basePath,"/api/auth/verify"));case 3:if(n=r.sent,s=n.ok,i=n.data,s){r.next=8;break}return r.abrupt("return",e.push("/login"));case 8:return r.next=10,t(Object(o.b)(i));case 10:f(O),b(!1);case 12:case"end":return r.stop()}}),r)})))).apply(this,arguments)}return Object(i.useEffect)((function(){!d&&O||function(){v.apply(this,arguments)}()}),[]),{user:O,loading:d}}},POTn:function(e,t,r){e.exports={metrics:"RealtimeHeader_metrics__3UCe2"}},Z2iK:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/analysis/realtime",function(){return r("j4r0")}])},cNLv:function(e,t,r){e.exports={table:"RealtimeLog_table__2Tl9b",header:"RealtimeLog_header__2LeBZ",row:"RealtimeLog_row__1a7u4",body:"RealtimeLog_body__3dkV9",icon:"RealtimeLog_icon__3aQPX",time:"RealtimeLog_time__PHd3a",website:"RealtimeLog_website__1eqHT",detail:"RealtimeLog_detail__2LyTK",link:"RealtimeLog_link__2ni65"}},j4r0:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return ge}));var n=r("nKUr"),a=r("q1tI"),s=r("80PL"),i=r("cpVT"),c=r("kriW"),o=r("/h9T"),l=r("IYaI"),u=r("jIYg");function d(e,t){Object(u.a)(2,arguments);var r=Object(o.a)(t);return Object(l.a)(e,-r)}var b=r("0LOL"),j=r("zsrT"),O=r.n(j),f=r("CUtM"),v=r("FtD2"),m=r("dhJC"),h=r("4+6U"),g=r("sWYD"),x=r("dndX"),_=r("rqNM"),p=r("rIuf"),w=r("YSmr");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function N(e){var t=0,r=[];return e.reduce((function(e,n){var a=n.created_at,s=Object(b.a)(Object(h.a)(a));return s.getTime()>t?(e={t:Object(g.a)(s,"yyyy-LL-dd HH:mm:00"),y:1},r.push(e),t=s):e.y+=1,e}),{}),r}function P(e){var t=e.data,r=e.unit,s=Object(m.a)(e,["data","unit"]),i=Object(b.a)(new Date),c=d(i,w.n),o=Object(a.useRef)(i),l=Object(a.useMemo)((function(){return t?{pageviews:Object(p.b)(N(t.pageviews),c,i,r),sessions:Object(p.b)(N(t.sessions),c,i,r)}:{pageviews:[],sessions:[]}}),[t]),u=Object(a.useMemo)((function(){return Object(x.a)(o.current,i)?(o.current=i,0):w.c}),[t]);return Object(n.jsx)(_.a,M(M({},s),{},{height:200,unit:r,data:l,animationDuration:u}))}var L,E=r("z7pX"),R=r("dDsW"),H=r("iR1w"),k=r("atwx"),D=r("fFFQ"),C=r("ty6r"),S=r("2K+N"),I=r("ZzUg"),T=r("m/GJ"),z=r("nsFc"),U=r("LAde");function V(){return(V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var F,K=function(e){return a.createElement("svg",V({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},e),L||(L=a.createElement("path",{d:"M296 160H180.6l42.6-129.8C227.2 15 215.7 0 200 0H56C44 0 33.8 8.9 32.2 20.8l-32 240C-1.7 275.2 9.5 288 24 288h118.7L96.6 482.5c-3.6 15.2 8 29.5 23.3 29.5 8.4 0 16.4-4.4 20.8-12l176-304c9.3-15.9-2.2-36-20.7-36z"})))};function W(){return(W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var X,A=function(e){return a.createElement("svg",W({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},e),F||(F=a.createElement("path",{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"})))};function B(){return(B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Y,Z=function(e){return a.createElement("svg",B({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},e),X||(X=a.createElement("path",{d:"M288 144a110.94 110.94 0 00-31.24 5 55.4 55.4 0 017.24 27 56 56 0 01-56 56 55.4 55.4 0 01-27-7.24A111.71 111.71 0 10288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 000 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 000-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z"})))},G=r("GGPy"),J=r("cNLv"),q=r.n(J),Q=(Y={},Object(i.a)(Y,1,Object(n.jsx)(Z,{})),Object(i.a)(Y,2,Object(n.jsx)(A,{})),Object(i.a)(Y,3,Object(n.jsx)(K,{})),Y);function $(e){var t=e.data,r=e.websites,s=e.websiteId,i=Object(R.a)(),o=Object(z.a)().locale,l=Object(U.a)(o),u=Object(a.useState)(0),d=u[0],b=u[1],j=Object(a.useMemo)((function(){var e=t.pageviews,r=t.sessions,n=t.events,a=[].concat(Object(E.a)(e),Object(E.a)(r),Object(E.a)(n)).sort(O()("created_at",-1));return d?a.filter((function(e){return m(e)===d})):a}),[t,d]),f=Object(a.useMemo)((function(){return t.sessions.reduce((function(e,t){var r=t.session_id,n=t.session_uuid;return e[r]=n,e}),{})}),[t]),v=[{label:Object(n.jsx)(c.a,{id:"label.all",defaultMessage:"All"}),value:0},{label:Object(n.jsx)(c.a,{id:"metrics.views",defaultMessage:"Views"}),value:1},{label:Object(n.jsx)(c.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),value:2},{label:Object(n.jsx)(c.a,{id:"metrics.events",defaultMessage:"Events"}),value:3}];function m(e){var t=e.view_id,r=e.session_id;return e.event_id?3:t?1:r?2:null}function h(e){return Q[m(e)]}function g(e){var t=e.website_id;return r.find((function(e){return e.website_id===t}))}function x(e){var t,r=e.event_type,a=e.event_value,s=e.view_id,o=e.session_id,u=e.url,d=e.browser,b=e.os,j=e.country,O=e.device,f=e.website_id;if(r)return Object(n.jsxs)("div",{children:[Object(n.jsx)(D.a,{children:r})," ",a]});if(s){var v,m=null===(v=g({website_id:f}))||void 0===v?void 0:v.domain;return Object(n.jsx)("a",{className:q.a.link,href:"//".concat(m).concat(u),target:"_blank",rel:"noreferrer noopener",children:u})}return o?Object(n.jsx)(c.a,{id:"message.log.visitor",defaultMessage:"Visitor from {country} using {browser} on {os} {device}",values:{country:Object(n.jsx)("b",{children:l[j]||i.formatMessage({id:"label.unknown",defaultMessage:"Unknown"})}),browser:Object(n.jsx)("b",{children:w.a[d]}),os:Object(n.jsx)("b",{children:b}),device:Object(n.jsx)("b",{children:null===(t=i.formatMessage(T.a[O]))||void 0===t?void 0:t.toLowerCase()})}}):void 0}function _(e){var t=e.created_at;return Object(p.a)(new Date(t),"pp",o)}function y(e){var t=e.session_id;return Object(G.d)(f[t]||"".concat(t).concat(g(e)))}return Object(n.jsxs)("div",{className:q.a.table,children:[Object(n.jsx)(S.a,{buttons:v,selected:d,onClick:b}),Object(n.jsx)("div",{className:q.a.header,children:Object(n.jsx)(c.a,{id:"label.realtime-logs",defaultMessage:"Realtime logs"})}),Object(n.jsxs)("div",{className:q.a.body,children:[0===(null===j||void 0===j?void 0:j.length)&&Object(n.jsx)(I.a,{}),(null===j||void 0===j?void 0:j.length)>0&&Object(n.jsx)(H.a,{height:400,itemCount:j.length,itemSize:40,children:function(e){var t,a=e.index,i=e.style,c=j[a];return Object(n.jsxs)("div",{className:q.a.row,style:i,children:[Object(n.jsx)("div",{children:Object(n.jsx)(C.a,{color:y(c)})}),Object(n.jsx)("div",{className:q.a.time,children:_(c)}),Object(n.jsxs)("div",{className:q.a.detail,children:[Object(n.jsx)(k.a,{className:q.a.icon,icon:h(c)}),x(c)]}),!s&&r.length>1&&Object(n.jsx)("div",{className:q.a.website,children:null===(t=g(c))||void 0===t?void 0:t.domain})]})}})]})]})}r("tfvX"),r("dB/W");var ee=r("NgRG"),te=r("POTn"),re=r.n(te);function ne(e){var t=e.websites,r=e.data,a=(e.websiteId,e.onSelect,[{label:Object(n.jsx)(c.a,{id:"label.all-websites",defaultMessage:"All websites"}),value:0}].concat(t.map((function(e,t){return{label:e.name,value:e.website_id,divider:0===t}}))),r.pageviews),s=r.sessions,i=r.events,o=r.countries;return Object(n.jsx)(n.Fragment,{children:Object(n.jsxs)("div",{className:re.a.metrics,children:[Object(n.jsx)(ee.a,{label:Object(n.jsx)(c.a,{id:"metrics.views",defaultMessage:"Views"}),value:a.length}),Object(n.jsx)(ee.a,{label:Object(n.jsx)(c.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),value:s.length}),Object(n.jsx)(ee.a,{label:Object(n.jsx)(c.a,{id:"metrics.events",defaultMessage:"Events"}),value:i.length}),Object(n.jsx)(ee.a,{label:Object(n.jsx)(c.a,{id:"metrics.countries",defaultMessage:"Countries"}),value:o.length})]})})}var ae=r("sjKz"),se=r("vX6h"),ie=r("GyfN");function ce(e){var t=e.websiteId,r=e.data,s=e.websites,i=r.pageviews,o=Object(a.useState)(0),l=o[0],u=o[1],d=Object(a.useMemo)((function(){return s.map((function(e){return e.domain}))}),[s]),b=Object(a.useCallback)((function(e){var t,r;return 1===s.length?null===(t=s[0])||void 0===t?void 0:t.domain:null===(r=s.find((function(t){return t.website_id===e})))||void 0===r?void 0:r.domain}),[s]),j=[{label:Object(n.jsx)(c.a,{id:"metrics.referrers",defaultMessage:"Referrers"}),value:0},{label:Object(n.jsx)(c.a,{id:"metrics.pages",defaultMessage:"Pages"}),value:1}],f=Object(a.useMemo)((function(){return i?[Object(ie.c)(i.reduce((function(e,t){var r=t.referrer;if(null!==r&&void 0!==r&&r.startsWith("http")){var n=new URL(r).hostname.replace(/^www\./,"");if(n&&!d.includes(n)){var a=e.find((function(e){return e.x===n}));a?a.y+=1:e.push({x:n,y:1})}}return e}),[]).sort(O()("y",-1))),Object(ie.c)(i.reduce((function(e,r){var n,a=r.url,i=r.website_id;if(null!==(n=a)&&void 0!==n&&n.startsWith("/")){!t&&s.length>1&&(a="".concat(b(i)).concat(a));var c=e.find((function(e){return e.x===a}));c?c.y+=1:e.push({x:a,y:1})}return e}),[]).sort(O()("y",-1)))]:[]}),[i]),v=f[0],m=f[1];return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(S.a,{buttons:j,selected:l,onClick:u}),0===l&&Object(n.jsx)(se.a,{title:Object(n.jsx)(c.a,{id:"metrics.referrers",defaultMessage:"Referrers"}),metric:Object(n.jsx)(c.a,{id:"metrics.views",defaultMessage:"Views"}),data:v,height:400}),1===l&&Object(n.jsx)(se.a,{title:Object(n.jsx)(c.a,{id:"metrics.pages",defaultMessage:"Pages"}),metric:Object(n.jsx)(c.a,{id:"metrics.views",defaultMessage:"Views"}),renderLabel:function(e){var r=e.x,a=r.startsWith("/")?b(t):"";return Object(n.jsx)("a",{href:"//".concat(a).concat(r),target:"_blank",rel:"noreferrer noopener",children:r})},data:m,height:400})]})}var oe=r("0Kmt"),le=r("j6bx"),ue=r.n(le);function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){Object(i.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e,t,r){var n=e.map((function(e){return e.__id}));return e.concat(t.filter((function(e){var t=e.__id;return!n.includes(t)}))).filter((function(e){var t=e.created_at;return new Date(t).getTime()>=r}))}function Oe(e,t){return e.filter((function(e){return e.website_id===t}))}function fe(){var e,t=Object(z.a)().locale,r=Object(U.a)(t),s=Object(a.useState)(),o=s[0],l=s[1],u=Object(a.useState)(0),j=u[0],m=u[1],h=Object(oe.a)("/api/realtime/init"),g=h.data,x=h.loading,_=Object(oe.a)("/api/realtime/update",{params:{start_at:null===o||void 0===o?void 0:o.timestamp},disabled:!(null!==g&&void 0!==g&&null!==(e=g.websites)&&void 0!==e&&e.length)||!o,interval:w.m,headers:Object(i.a)({},w.r,null===g||void 0===g?void 0:g.token)}).data,p=Object(a.useCallback)((function(e){var a=e.x;return Object(n.jsx)("span",{className:t,children:r[a]})}),[r]),y=Object(a.useMemo)((function(){if(o){var e=o.pageviews,t=o.sessions,r=o.events;if(j)return{pageviews:Oe(e,j),sessions:Oe(t,j),events:Oe(r,j)}}return o}),[o,j]),M=Object(a.useMemo)((function(){return null!==y&&void 0!==y&&y.sessions?Object(ie.c)(y.sessions.reduce((function(e,t){var r=t.country;if(r){var n=e.find((function(e){return e.x===r}));n?n.y+=1:e.push({x:r,y:1})}return e}),[]).sort(O()("y",-1))):[]}),[null===y||void 0===y?void 0:y.sessions]);if(Object(a.useEffect)((function(){if(g&&!o){var e=g.websites,t=g.data;l(be({websites:e},t))}}),[g]),Object(a.useEffect)((function(){if(_){var e=_.pageviews,t=_.sessions,r=_.events,n=_.timestamp,a=d(Object(b.a)(new Date),w.n).getTime();l((function(s){return be(be({},s),{},{pageviews:je(s.pageviews,e,a),sessions:je(s.sessions,t,a),events:je(s.events,r,a),timestamp:n})}))}}),[_]),!g||!o||x)return null;var N=o.websites;return Object(n.jsxs)(f.a,{children:[Object(n.jsx)(ne,{websites:N,websiteId:j,data:be(be({},y),{},{countries:M}),onSelect:m}),Object(n.jsx)("div",{className:ue.a.chart,children:Object(n.jsx)(P,{websiteId:j,data:y,unit:"minute",records:w.n})}),Object(n.jsxs)(v.c,{children:[Object(n.jsxs)(v.b,{children:[Object(n.jsx)(v.a,{xs:12,lg:4,children:Object(n.jsx)(ce,{websiteId:j,data:y,websites:N})}),Object(n.jsx)(v.a,{xs:12,lg:8,children:Object(n.jsx)($,{websiteId:j,data:y,websites:N})})]}),Object(n.jsxs)(v.b,{children:[Object(n.jsx)(v.a,{xs:12,lg:4,children:Object(n.jsx)(se.a,{title:Object(n.jsx)(c.a,{id:"metrics.countries",defaultMessage:"Countries"}),metric:Object(n.jsx)(c.a,{id:"metrics.visitors",defaultMessage:"Visitors"}),data:M,renderLabel:p,height:500})}),Object(n.jsx)(v.a,{xs:12,lg:8,children:Object(n.jsx)(ae.a,{data:M})})]})]})]})}var ve=r("IA1E"),me=r("vRNQ"),he=r.n(me);function ge(){return Object(ve.a)().loading?null:Object(n.jsx)("div",{children:Object(n.jsxs)(s.a,{headerType:"analysis",children:[Object(n.jsxs)("h1",{className:he.a.title,children:["Analysis ",Object(n.jsx)("span",{className:he.a.orange,children:"Realtime"})]}),Object(n.jsxs)("div",{className:he.a.flex,children:[Object(n.jsx)("a",{href:"/",className:he.a.card,children:Object(n.jsx)("h2",{children:"\u2190 Home"})}),Object(n.jsx)("a",{href:"/analysis",className:he.a.card,children:Object(n.jsx)("h2",{children:"\u2190 Analysis"})}),Object(n.jsx)("a",{href:"/analysis/dashboard",className:he.a.card,children:Object(n.jsx)("h2",{children:"Dashboard \u2192"})})]}),Object(n.jsx)(fe,{})]})})}},j6IE:function(e,t,r){"use strict";r.d(t,"b",(function(){return s}));var n=r("i7Pf"),a=Object(n.b)({name:"user",initialState:null,reducers:{updateUser:function(e,t){return t.payload}}}),s=a.actions.updateUser;t.a=a.reducer},j6bx:function(e,t,r){e.exports={container:"RealtimeDashboard_container__1ZLx1",chart:"RealtimeDashboard_chart__1LaXv"}},vRNQ:function(e,t,r){e.exports={orange:"Home_orange__2Ws-k",container:"Home_container__1EcsU",main:"Home_main__1x8gC",footer:"Home_footer__1WdhD",title:"Home_title__3DjR7",description:"Home_description__17Z4F",code:"Home_code__axx2Y",grid:"Home_grid__2Ei2F",flex:"Home_flex__-Lep2",card:"Home_card__2SdtB",card45:"Home_card45__TeeSF",card25:"Home_card25__1Uh8X",card75:"Home_card75__26Ifx",logo:"Home_logo__1YbrH"}}},[["Z2iK",0,1,7,8,13,2,3,4,5,9,14,16]]]);