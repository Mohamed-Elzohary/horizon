{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport classNames from 'classnames';\nimport Loading from 'components/common/Loading';\nimport ErrorMessage from 'components/common/ErrorMessage';\nimport useFetch from 'hooks/useFetch';\nimport useDateRange from 'hooks/useDateRange';\nimport usePageQuery from 'hooks/usePageQuery';\nimport useShareToken from 'hooks/useShareToken';\nimport { formatShortTime, formatNumber, formatLongNumber } from 'lib/format';\nimport { TOKEN_HEADER } from 'lib/constants';\nimport MetricCard from './MetricCard';\nimport styles from './MetricsBar.module.css';\nexport default function MetricsBar({\n  websiteId,\n  className\n}) {\n  const shareToken = useShareToken();\n  const [dateRange] = useDateRange(websiteId);\n  const {\n    startDate,\n    endDate,\n    modified\n  } = dateRange;\n  const {\n    0: format,\n    1: setFormat\n  } = useState(true);\n  const {\n    query: {\n      url\n    }\n  } = usePageQuery();\n  const {\n    data,\n    error,\n    loading\n  } = useFetch(`/api/website/${websiteId}/stats`, {\n    params: {\n      start_at: +startDate,\n      end_at: +endDate,\n      url\n    },\n    headers: {\n      [TOKEN_HEADER]: shareToken === null || shareToken === void 0 ? void 0 : shareToken.token\n    }\n  }, [url, modified]);\n  const formatFunc = format ? n => n >= 0 ? formatLongNumber(n) : `-${formatLongNumber(Math.abs(n))}` : formatNumber;\n\n  function handleSetFormat() {\n    setFormat(state => !state);\n  }\n\n  const {\n    pageviews,\n    uniques,\n    bounces,\n    totaltime\n  } = data || {};\n  const num = Math.min(data && uniques.value, data && bounces.value);\n  const diffs = data && {\n    pageviews: pageviews.value - pageviews.change,\n    uniques: uniques.value - uniques.change,\n    bounces: bounces.value - bounces.change,\n    totaltime: totaltime.value - totaltime.change\n  };\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: classNames(styles.bar, className),\n    onClick: handleSetFormat,\n    children: [!data && loading && /*#__PURE__*/_jsx(Loading, {}), error && /*#__PURE__*/_jsx(ErrorMessage, {}), data && !error && /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(MetricCard, {\n        label: /*#__PURE__*/_jsx(FormattedMessage, {\n          id: \"metrics.views\",\n          defaultMessage: \"Views\"\n        }),\n        value: pageviews.value,\n        change: pageviews.change,\n        format: formatFunc\n      }), /*#__PURE__*/_jsx(MetricCard, {\n        label: /*#__PURE__*/_jsx(FormattedMessage, {\n          id: \"metrics.visitors\",\n          defaultMessage: \"Visitors\"\n        }),\n        value: uniques.value,\n        change: uniques.change,\n        format: formatFunc\n      }), /*#__PURE__*/_jsx(MetricCard, {\n        label: /*#__PURE__*/_jsx(FormattedMessage, {\n          id: \"metrics.bounce-rate\",\n          defaultMessage: \"Bounce rate\"\n        }),\n        value: uniques.value ? num / uniques.value * 100 : 0,\n        change: uniques.value && uniques.change ? num / uniques.value * 100 - Math.min(diffs.uniques, diffs.bounces) / diffs.uniques * 100 || 0 : 0,\n        format: n => Number(n).toFixed(0) + '%',\n        reverseColors: true\n      }), /*#__PURE__*/_jsx(MetricCard, {\n        label: /*#__PURE__*/_jsx(FormattedMessage, {\n          id: \"metrics.average-visit-time\",\n          defaultMessage: \"Average visit time\"\n        }),\n        value: totaltime.value && pageviews.value ? totaltime.value / (pageviews.value - bounces.value) : 0,\n        change: totaltime.value && pageviews.value ? (diffs.totaltime / (diffs.pageviews - diffs.bounces) - totaltime.value / (pageviews.value - bounces.value)) * -1 || 0 : 0,\n        format: n => `${n < 0 ? '-' : ''}${formatShortTime(Math.abs(~~n), ['m', 's'], ' ')}`\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}